<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>마이페이지 | 중고마켓</title>
    <th:block th:replace="fragments/header :: globalHead"></th:block>
    <link rel="stylesheet" href="/css/components/pagination.css" th:href="@{/css/components/pagination.css}">
    <link rel="stylesheet" href="/css/my/index.css" th:href="@{/css/my/index.css}">
</head>
<body class="my-page-body">
<div th:replace="fragments/header :: siteHeader"></div>

<main class="my-page">
    <section class="my-hero">
        <div class="my-hero__text">
            <p class="my-hero__welcome" th:text="${nickname != null} ? |${nickname}님, 반가워요!| : '안녕하세요!'">홍길동님, 반가워요!</p>
            <p class="my-hero__subtitle">안전하고 즐거운 거래를 이어가볼까요?</p>
        </div>
        <button type="button" id="logoutBtn" class="my-hero__logout">로그아웃</button>
    </section>

    <section class="my-section">
        <div class="my-section__head">
            <h2>내가 쓴 글</h2>
            <a class="my-section__link" th:href="@{/product/new}">새 글 쓰기</a>
        </div>
        <p class="my-section__empty" id="myPostsEmpty" th:if="${#lists.isEmpty(myProducts)}">
            아직 작성한 글이 없어요. 첫 글을 등록해 보세요!
        </p>
        <div class="my-products product-grid" id="myPosts" th:if="${!#lists.isEmpty(myProducts)}">
            <a class="product-card" th:each="product : ${myProducts}" th:href="@{|/product/${product.id}|}">
                <div class="product-card__thumb"
                     th:style="|background-image:url('/files/${product.thumbnailUrl}')|"></div>
                <div class="product-card__body">
                    <div class="product-card__title" th:text="${product.title}">등록한 상품 제목</div>
                    <div class="product-card__price"
                         th:text="${#numbers.formatInteger(product.price,3,'COMMA')} + '원'">0원</div>
                    <div class="text-secondary small" th:text="${product.categoryName}">카테고리</div>
                    <div class="product-card__meta">
                        <span th:text="${product.region}">지역</span>
                        <span th:text="${#temporals.format(product.createdAt,'M/d HH:mm')}">3/1 12:00</span>
                    </div>
                    <div class="mt-2" th:if="${product.safePay}">
                        <span class="badge-safe">안전결제</span>
                    </div>
                </div>
            </a>
        </div>
        <nav class="mt-4" th:if="${page != null and page.totalPages > 1}" aria-label="내가 쓴 글 페이지네이션">
            <ul class="pagination justify-content-center"
                th:with="current=${page.page}, total=${page.totalPages}, start=${current - 2 > 1 ? current - 2 : 1}, end=${current + 2 < total ? current + 2 : total}">
                <li class="page-item" th:classappend="${!page.hasPrevious} ? ' disabled'">
                    <a class="page-link"
                       th:href="@{/my(page=${page.hasPrevious} ? ${page.page - 1} : ${page.page}, size=${page.size})}"
                       aria-label="이전">
                        이전
                    </a>
                </li>
                <li class="page-item"
                    th:each="pageNum : ${#numbers.sequence(start, end)}"
                    th:classappend="${pageNum == page.page} ? ' active'">
                    <a class="page-link"
                       th:href="@{/my(page=${pageNum}, size=${page.size})}"
                       th:text="${pageNum}">1</a>
                </li>
                <li class="page-item" th:classappend="${!page.hasNext} ? ' disabled'">
                    <a class="page-link"
                       th:href="@{/my(page=${page.hasNext} ? ${page.page + 1} : ${page.page}, size=${page.size})}"
                       aria-label="다음">
                        다음
                    </a>
                </li>
            </ul>
        </nav>
    </section>
</main>

<div th:replace="fragments/footer :: siteFooter"></div>
<th:block th:replace="fragments/footer :: globalScripts"></th:block>
<script src="/js/my/index.js" th:src="@{/js/my/index.js}"></script>
</body>
</html>
