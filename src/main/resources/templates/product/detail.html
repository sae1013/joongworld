<!doctype html>
<html lang="ko" data-bs-theme="dark" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title th:text="${product.title} ?: '상품 상세'">상품 상세</title>
    <th:block th:replace="fragments/header :: globalHead"></th:block>
    <th:block th:replace="fragments/editor :: editorHead"></th:block>
    <link href="/css/product/detail.css" th:href="@{/css/product/detail.css}" rel="stylesheet">
</head>
<body>
<div th:replace="fragments/header :: siteHeader"></div>

<main class="page">
    <!-- breadcrumb -->
    <nav class="mb-2" aria-label="breadcrumb">
        <ol class="breadcrumb small">
            <li class="breadcrumb-item"><a class="text-decoration-none" th:href="@{/}">홈</a></li>
            <li class="breadcrumb-item">
                <a class="text-decoration-none"
                   th:href="${product.categoryId} != null ? @{|/search?category=${product.categoryId}|} : '#'"
                   th:text="${product.categoryName}"></a>
            </li>
            <li class="breadcrumb-item active" aria-current="page"
                th:text="${product.title}"></li>
        </ol>
    </nav>

    <div class="row g-3">
        <!-- 좌: 갤러리 -->
        <div class="col-lg-7"
             th:with="hasImages=${product.images != null and !#lists.isEmpty(product.images)},
                      mainImage=${hasImages ? product.images[0] : null}">
            <div class="gallery">
                <div id="mainImage" class="gallery__main"
                     th:if="${hasImages}"
                     th:style="|background-image:url('${mainImage}')|"
                     style="background-image:url('https://picsum.photos/1200/900?random=1')"></div>
                <div id="mainImagePlaceholder" class="gallery__main"
                     th:unless="${hasImages}"
                     style="background-image:url('https://picsum.photos/1200/900?random=1')"></div>
                <div class="thumbs" th:if="${hasImages}">
                    <div class="thumb"
                         th:each="img, iStat : ${product.images}"
                         th:classappend="${iStat.index == 0} ? ' active'"
                         role="button"
                         th:aria-label="|이미지 ${iStat.index + 1}|"
                         th:data-src="${img}"
                         th:style="|background-image:url('${img}')|"></div>
                </div>
            </div>
        </div>

        <!-- 우: 요약 카드 -->
        <div class="col-lg-5">
            <div class="summary">
                <div class="d-flex align-items-start justify-content-between gap-2">
                    <h1 class="h4 fw-bold m-0" th:text="${product.title}"></h1>
                </div>
                <div class="mt-1 text-secondary small">
                    <div th:if="${product.createdAt != null}"
                         th:text="|작성일: ${#temporals.format(product.createdAt, 'M월 d일 a h시 m분')}|">
                    </div>
                    <div th:if="${product.region != null and !#strings.isEmpty(product.region)}"
                         th:text="|지역: ${product.region}|">지역: 서울 강남</div>
                </div>

                <div class="price mt-2" th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')} + '원'">
                    1,800,000원
                </div>

                <div class="mt-2 d-flex flex-wrap gap-2">
                    <span class="badge rounded-pill badge-soft" th:if="${product.safePay}"
                          th:text="'안전결제 가능'">안전결제</span>
                    <span class="badge rounded-pill badge-soft"
                          th:text="${product.conditionStatus}">상품 상태</span>
                </div>

                <hr class="divider my-3"/>

                <div class="option-row align-items-center mb-2">
                    <div class="text-secondary small">거래방식</div>
                    <div class="d-flex flex-wrap small option-list">
                        <span class="badge rounded-pill badge-soft me-2"
                              th:if="${product.shippingAvailable}">택배 거래 가능</span>
                        <span class="badge rounded-pill badge-soft"
                              th:if="${product.meetupAvailable}">직거래 가능</span>
                    </div>
                </div>

                <div class="option-row align-items-center mb-2">
                    <div class="text-secondary small">배송비</div>
                    <div class="small option-value"
                         th:text="${product.shippingCost > 0 ? #numbers.formatInteger(product.shippingCost, 3, 'COMMA') + '원' : '무료배송'}"></div>
                </div>

                <!--                <div class="option-row align-items-center mb-2">-->
                <!--                    <div class="text-secondary small">메모</div>-->
                <!--                </div>-->

                <!--          <div class="mt-3 d-flex gap-2">-->
                <!--            <button class="btn btn-outline-light flex-grow-1">채팅하기</button>-->
                <!--            <button class="btn btn-brand flex-grow-1">구매하기</button>-->
                <!--          </div>-->
                <!--          <div class="mt-2 small text-secondary">지금 이 상품 사면 곧바로 안전하게 결제됩니다.</div>-->
            </div>
        </div>
    </div>

    <!--    <section class="section">-->
    <!--        <h2 class="h6 fw-bold mb-2">새 상품은 어떠세요?</h2>-->
    <!--        <div class="h-scroll">-->
    <!--            ... 추천 상품 영역 (서버 연동 후 활성화) ...-->
    <!--        </div>-->
    <!--    </section>-->

    <!-- 상세 설명 -->
    <section class="section">
        <h2 class="h6 fw-bold mb-2">상품 설명</h2>
        <div class="rounded-4 p-3">
            <div th:replace="~{fragments/editor :: editorContainer('editor')}"></div>
        </div>
    </section>
</main>

<div th:replace="fragments/footer :: siteFooter"></div>

<th:block th:replace="fragments/footer :: globalScripts"></th:block>
<th:block th:replace="fragments/editor :: editorScripts"></th:block>
<script src="/js/product/detail.js" th:src="@{/js/product/detail.js}"></script>
</body>
</html>
