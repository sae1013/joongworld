<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.softworks.joongworld.user.repository.UserMapper">

    <select id="existsByEmail" resultType="boolean">
        select exists(
            select 1
            from "user"
            where lower(email) = lower(#{email})
        )
    </select>

    <select id="existsByNickname" resultType="boolean">
        select exists(
            select 1
            from "user"
            where nickname = #{nickname}
        )
    </select>

    <insert id="insertUser">
        insert into "user" (
            email,
            password_hash,
            name,
            nickname,
            is_admin
        ) values (
            #{email},
            #{passwordHash},
            #{name},
            #{nickname},
            #{isAdmin}
        )
    </insert>

    <select id="findIdByEmail" resultType="long">
        select id
        from "user"
        where lower(email) = lower(#{email})
    </select>

    <select id="findById" resultType="com.softworks.joongworld.user.dto.UserResponse">
        select id,
               email,
               name,
               nickname,
               is_admin as isAdmin,
               created_at as createdAt,
               updated_at as updatedAt
        from "user"
        where id = #{id}
    </select>

    <select id="findByEmail" resultType="com.softworks.joongworld.user.dto.UserResponse">
        select id,
               email,
               name,
               nickname,
               is_admin as isAdmin,
               created_at as createdAt,
               updated_at as updatedAt
        from "user"
        where lower(email) = lower(#{email})
    </select>

    <select id="findByNickname" resultType="com.softworks.joongworld.user.dto.UserResponse">
        select id,
               email,
               name,
               nickname,
               is_admin as isAdmin,
               created_at as createdAt,
               updated_at as updatedAt
        from "user"
        where nickname = #{nickname}
    </select>
</mapper>
