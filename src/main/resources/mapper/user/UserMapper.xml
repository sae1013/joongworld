<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.softworks.joongworld.user.repository.UserMapper">

    <select id="existsByEmail" resultType="boolean">
        SELECT EXISTS(
            SELECT 1
            FROM "user"
            WHERE LOWER(email) = LOWER(#{email})
        )
    </select>

    <select id="existsByNickname" resultType="boolean">
        SELECT EXISTS(
            SELECT 1
            FROM "user"
            WHERE nickname = #{nickname}
        )
    </select>

    <insert id="insertUser">
        INSERT INTO "user" (
            email,
            password_hash,
            name,
            nickname,
            is_admin
        ) VALUES (
            #{email},
            #{passwordHash},
            #{name},
            #{nickname},
            #{isAdmin}
        )
    </insert>

    <select id="findIdByEmail" resultType="long">
        SELECT id
        FROM "user"
        WHERE LOWER(email) = LOWER(#{email})
    </select>

    <select id="findById" resultType="com.softworks.joongworld.user.dto.UserResponse">
        SELECT id,
               email,
               name,
               nickname,
               is_admin AS isAdmin,
               created_at AS createdAt,
               updated_at AS updatedAt
        FROM "user"
        WHERE id = #{id}
    </select>

    <select id="findByEmail" resultType="com.softworks.joongworld.user.dto.UserResponse">
        SELECT id,
               email,
               name,
               nickname,
               is_admin AS isAdmin,
               created_at AS createdAt,
               updated_at AS updatedAt
        FROM "user"
        WHERE LOWER(email) = LOWER(#{email})
    </select>

    <select id="findByNickname" resultType="com.softworks.joongworld.user.dto.UserResponse">
        SELECT id,
               email,
               name,
               nickname,
               is_admin AS isAdmin,
               created_at AS createdAt,
               updated_at AS updatedAt
        FROM "user"
        WHERE nickname = #{nickname}
    </select>

    <select id="findAuthByEmail" resultType="com.softworks.joongworld.user.dto.UserAuth">
        SELECT id,
               email,
               password_hash AS passwordHash,
               name,
               nickname,
               is_admin AS isAdmin
        FROM "user"
        WHERE LOWER(email) = LOWER(#{email})
    </select>
</mapper>
